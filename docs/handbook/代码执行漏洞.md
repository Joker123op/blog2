# 代码执行漏洞

代码执行漏洞原理：

用户输入的数据被当作后端代码执行

`<?php @eval($_REQUEST[8])?>` 其实一句话木马的本质就是一个代码执行漏洞。用户输入的数据被当作代码进行执行。

RCE远程命令或者代码执行。现在因为RCE这个词滥用，RCE的范围比较广，只要渗透的最终情况可以实现执行命令或者是代码都属于RCE，例如代码执行、文件包含、反序列化、命令执行，甚至是写文件Getshell都可以输入RCE

eval可以一次性执行多行代码


还有一个一句话木马

```PHP
<?php
echo preg_replace('/a/e',$_GET[8],'abc');
?>
```


正则表达式：

/a/i -> a是正则标识 i是修饰符(不区分大小写)

/a/e -> a是正则表达式，e是修饰符(要去替换的值可以用php的代码去执行)

一些一句话木马漏洞

多看看开发手则，说不定能找到开发不知道的漏洞


```PHP
<?php
$a = create_function('$id',$_REQUEST)
?>
```

> 使用：}phpinfo();/

```PHP
<?php
$a = [1, 2, 3, 4, 5];
$b = array_map($_REQUEST[1], $_REQUEST[2]);
?>
```

CMS安装的本质就是把原始的数据写入数据库

## 本地包含与远程包含

* 文件包含漏洞

攻击者利用包含的特性，加上应用本身对文件(包含)控制不严格，最终造成攻击者进行任意文件包含。（注：包含的文件会被当成脚本文件进行解析）。

一句话来说就是：文件包含并不属于漏洞，但是由于对包含进来的文件不可控，导致了文件包含漏洞的产生。

<br />

> 包含文件很有用，可以简化代码
文件包含包括本地包含和远程文件包含（需要allow_url_include = On）
本地文件包含LFI远程文件包含RFI

相同代码重复出现在不同文件中出现代码冗余，所以出现了文件包含函数。就是为了让代码更加高效，需要用到的部分代码会去调用，且被包含的文件会被当作php代码执行，忽略后缀本身。

* 文件包含的函数

> `include`PHP运行到include然后去调用被包含的文件执行，如果包含文件不存在、报错也会继续向下执行。

<br />

> `require`PHP在运行之前，就先去把被包含的文件的内容进行提取出来然后整合成一个新的PHP一起执行。如果包含的文件不存在，报错，就不会往下执行了

在代码审计一个代码的时候，可以使用代码审计软件进行快速审计关键词

当然在时间充足的情况下通读全文是最好的选择

