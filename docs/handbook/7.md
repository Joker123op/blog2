## 什么是SQL注入

注入攻击的本质，是把用户输入的数据当作代码执行。

这里有两个关键条件

* 用户能够控制输入
* 原本程序要执行的代码，拼接了**用户输入的数据然后执行**。

sql注入就是针对sql语句的注入，也可以理解为用户输入的数据当作sql语句的代码执行了

sql注入是1998年一名叫rfp的黑客发表的一篇文章所进入大众视线的

## 试探网页是否存在sql注入

这里以掌控者的靶场[猫舍](http://pu2lh35s.ia.aqlab.cn/)为例

在网站的主页面中查看url，可以发现网址栏上有一个/？ id = 1

![Img](https://joker-1317382260.cos.ap-guangzhou.myqcloud.com/202304071635313.webp)


很明显这是一个get请求，并且需要传递的参数是id

那么尝试一下将id的值改变

![Img](https://joker-1317382260.cos.ap-guangzhou.myqcloud.com/202304071636375.webp)

可以看到页面也跟着变了，这说明该网站可能存在sql注入点，因为他在用户输入了以后会执行相应的操作

接下来还要分清楚一个概念

区分**字符串**和**代码**的区别

字符串不具有代码意义，就是纯文本而代码是会执行的命令

在该网站的url栏中id这个参数还可以以其他方法进行sql注入。

当`id=1 and 1=1`时，按照代码的逻辑，这个肯定是成立的，提交给浏览器试试看会不会有反应

![Img](https://joker-1317382260.cos.ap-guangzhou.myqcloud.com/202304071647175.webp)

可以看到输入以后页面回显正常，那么进一步尝试，当`id = 1 and 1=2`时会怎么样，按照代码逻辑这个是一定会报错的。

![Img](https://joker-1317382260.cos.ap-guangzhou.myqcloud.com/202304071648756.webp)

页面的信息消失了且没有回显，现在可以确定该网站存在sql注入

在数据库中所有的id字段数据类型都是整数，但是在查询语句去查询的时候要求id等于一个`字符串`类型

这个时候它会给我们的字符串进行强制类型转换。在这个过程中，如果输入的id是字母，则全部为0处理

也就是假设`id=1dawdawdawdwafb`后面无论跟着什么，在强制转换后id都是1后面的会被忽略。这是一个规则不是漏洞。

并且数据库还十分只能，可以直接在url栏来进行加减乘除。

url的中文名是**统一资源定位符**他有着自己独特的编码，也就是url编码。而+号在这里面有着特殊的意义，也就是空格的意思

也就是说在url栏中正常输入+号会被当作空格处理，如果想要使用+号必须使用url编码后的+，`%2b`才能执行+法

还可以使用sleep函数来判断是否存在。

用法就是直接输入sleep(10)也就是叫页面休眠10秒钟再返回数据。

![Img](https://joker-1317382260.cos.ap-guangzhou.myqcloud.com/202304071705131.webp)

可以看到页面正在加载。证明我们输入进去的字符被当成命令执行了，这就是显错注入

## 查询数据库字段

可以使用`order by`函数

![Img](https://joker-1317382260.cos.ap-guangzhou.myqcloud.com/202304071715193.webp)

这里输入order by 1有回显，证明该页面最有一个字段，那么再试试3.

![Img](https://joker-1317382260.cos.ap-guangzhou.myqcloud.com/202304071716069.webp)

这里报错了，说明他小于3个字段，那么再试试2.

![Img](https://joker-1317382260.cos.ap-guangzhou.myqcloud.com/202304071716690.webp)

有正常的回显，证明这个页面一共只有2个字段。

## sql注入查询当前网页的数据库命

函数是`database()`

在这例题中的用法是这样

`?id=1 and 1=2 union select 1,database()` 回车

![Img](https://joker-1317382260.cos.ap-guangzhou.myqcloud.com/202304071739026.webp)

可以看到回显数据库名字了

` ?id=1 and 1=2 union select 1,table_name from information_schema.tables where table_schema=database() limit 0,1`查询当前数据库下的表名

![Img](https://joker-1317382260.cos.ap-guangzhou.myqcloud.com/202304071741136.webp)


在大部分情况下管理员账号密码都在admin表里


