## 什么是SQL注入

注入攻击的本质，是把用户输入的数据当作代码执行。

这里有两个关键条件

* 用户能够控制输入
* 原本程序要执行的代码，拼接了**用户输入的数据然后执行**。

sql注入就是针对sql语句的注入，也可以理解为用户输入的数据当作sql语句的代码执行了

sql注入是1998年一名叫rfp的黑客发表的一篇文章所进入大众视线的

## 试探网页是否存在sql注入

这里以掌控者的靶场[猫舍](http://pu2lh35s.ia.aqlab.cn/)为例

在网站的主页面中查看url，可以发现网址栏上有一个`/?id=1`

![Img](https://joker-1317382260.cos.ap-guangzhou.myqcloud.com/202304071635313.webp)


很明显这是一个get请求，并且需要传递的参数是id

那么尝试一下将id的值改变

![Img](https://joker-1317382260.cos.ap-guangzhou.myqcloud.com/202304071636375.webp)

可以看到页面也跟着变了，这说明该网站可能存在sql注入点，因为他在用户输入了以后会执行相应的操作

接下来还要分清楚一个概念

区分**字符串**和**代码**的区别

字符串不具有代码意义，就是纯文本而代码是会执行的命令

在该网站的url栏中id这个参数还可以以其他方法进行sql注入。

当`id=1 and 1=1`时，按照代码的逻辑，这个肯定是成立的，提交给浏览器试试看会不会有反应

![Img](https://joker-1317382260.cos.ap-guangzhou.myqcloud.com/202304071647175.webp)

可以看到输入以后页面回显正常，那么进一步尝试，当`id=1 and 1=2`时会怎么样，按照代码逻辑这个是一定会报错的。

![Img](https://joker-1317382260.cos.ap-guangzhou.myqcloud.com/202304071648756.webp)

页面的信息消失了且没有回显，现在可以确定该网站存在sql注入

在数据库中所有的id字段数据类型都是整数，但是在查询语句去查询的时候要求id等于一个`字符串`类型

这个时候它会给我们的字符串进行强制类型转换。在这个过程中，如果输入的id是字母，则全部为0处理

也就是假设`id=1dawdawdawdwafb`后面无论跟着什么，在强制转换后id都是1后面的会被忽略。这是一个规则不是漏洞。

并且数据库还十分只能，可以直接在url栏来进行加减乘除。

url的中文名是**统一资源定位符**他有着自己独特的编码，也就是url编码。而+号在这里面有着特殊的意义，也就是空格的意思

也就是说在url栏中正常输入+号会被当作空格处理，如果想要使用+号必须使用url编码后的+，`%2b`才能执行+法

还可以使用sleep函数来判断是否存在。

用法就是直接输入sleep(10)也就是叫页面休眠10秒钟再返回数据。

![Img](https://joker-1317382260.cos.ap-guangzhou.myqcloud.com/202304071705131.webp)

可以看到页面正在加载。证明我们输入进去的字符被当成命令执行了，这就是显错注入

## 查询数据库字段

可以使用`order by`函数

![Img](https://joker-1317382260.cos.ap-guangzhou.myqcloud.com/202304071715193.webp)

这里输入order by 1有回显，证明该页面最有一个字段，那么再试试3.

![Img](https://joker-1317382260.cos.ap-guangzhou.myqcloud.com/202304071716069.webp)

这里报错了，说明他小于3个字段，那么再试试2.

![Img](https://joker-1317382260.cos.ap-guangzhou.myqcloud.com/202304071716690.webp)

有正常的回显，证明这个页面一共只有2个字段。

## sql注入查询当前网页的数据库命

函数是`database()`

在这例题中的用法是这样

`?id=1 and 1=2 union select 1,database()` 回车

![Img](https://joker-1317382260.cos.ap-guangzhou.myqcloud.com/202304071739026.webp)

可以看到回显数据库名字了

`?id=1 and 1=2 union select 1,table_name from information_schema.tables where table_schema=database() limit 0,1`查询当前数据库下的表名

![Img](https://joker-1317382260.cos.ap-guangzhou.myqcloud.com/202304071741136.webp)


在大部分情况下管理员账号密码都在admin表里

`?id=1 and 1=2 union select 1,column_name from information_schema.columns where table_schema=database() and table_name='admin'`

![Img](https://joker-1317382260.cos.ap-guangzhou.myqcloud.com/202304071942865.webp)

这样我们得到了到第一个字段

如果网页有多个字段的话可以引用limit函数。 

当然还可以使用sqlmap来进行扫描，这里附上一个[sqlmap使用手则](https://www.cnblogs.com/hongfei/p/3872156.html)

## limit的作用

limit 0,1  => 更多是用来分页但还有一种意思，就是从第一行取一条数据

limit 1,1  从第二行取一条数据

limit 1,2  从第二行取两条数据

库>表>字段

## POST注入

POST注入也有两个关键条件

* 1、用户能控制输入
* 2、原本程序要执行的代码，拼接了用户输入的数据。

POST注入的高危点：

* 登录框
* 查询框
* 等各种和数据库有交互的框

POST传参和GET类型没有什么区别。

header注入都是在登录后才会产生，因为他只会记录用户，不会记录游客。

插入的语句很可能没有回显

1、盲注(比较复杂)、
2、报错注入(让数据报错，强行看返回)

## HEAD注入

安全和用户体验是对立的，用户体验比安全高，所以，不存在没有漏洞的程序。

ip的获取是有讲究的分为

代理

* 透明代理(目标知道你是谁)
* 高匿代理(完全不知道是谁在访问)

而head注入一般是这几种方式

* ip
* UA
* refer
* cookie


### updatexml函数

updatexml()更新xml文档的函数

语法：uodatexml(1,concat(0x7e,(SELECT database()),0x7e),1)

实际上这里去更新了xml文档，但是我们在xml文档路径的位置里面写入了子查询，我们输入特殊字符，然后会因为不符合输入规则然后报错

但是报错的时候他其实已经执行了那个子查询代码！

0x7e是16进制，MSQL支持16进制，但是开头要写0x，0x7e是一个特殊符号，然后不符合路径规则报错

用法是`select updatexml(1,'!a',1)`

这样数据库就会找不到我要的这个东西，会看不懂`!a`是什么意思就会回显报错

`concat('!',database())`这行代码的意思就是将`!`和`database`的信息连接到一起


## 盲注

盲注所对应的是显错注入，如果服务器关闭了错误回显，这样即使有报错也不会显示，你也不会知道

所谓的盲注就是在服务器没有错误回显的时候完成的注入攻击。

服务器没有错误回显，对于攻击者来说缺少了非常重要的“调试信息”。

盲注又分为`布尔盲注`和`时间盲注`

**布尔盲注**

* 布尔很明显Ture跟False，也就是说他只会根据你的注入信息返回Ture和False，也就没有了之前的报错信息。

**时间盲注**

* 界面返回值只有一种，Ture无论输入任何值返回情况都会按照正常的来处理。加入特定的时间函数，通过查看web页面返回的时间来判断注入语句是否正确。

盲注需要掌握的几个函数

| 函数名 | 作用 |
| :--: | :--: |
| length() | 返回字符串的长度 |
| substr() | 截取字符串(语法:SUBSTR(str,pos,len); ) |
| ascii() | 返回字符的ascii码（将字符变成数字wei） |
| sleep() | 将程序挂起一段时间n为n秒 |
| if(expr1,expr2,expr3) | 判断语句，如果第一个语句正确就执行第二个语句，如果错误就执行第三个语句 |





## Burpsuite

这是一款功能非常强大的抓包改包软件。在Windows环境下，如果要使用这个工具。建议使用Java8的Java环境。

如果是Java8以上的环境建议使用最新版的`burpsuite`。否则会出现不兼容无法使用。高版本也有很多好用的功能

比如说：

* 1、高版本中内置了一个浏览器，可以免去安装HTTPS证书
* 2、并且不再需要手动配置代理
* 3、功能更多更完善

建议是使用破解专业版，因为在实际做题的时候如果遇见需要爆破的场景，社区版是不支持开启多线程模式的，而付费版是可以开启多线程模式的。

这样一来可以大大的提升请求速度，节约时间成本，以至于在爆破一些比较大的数据时会耗时过久

这里附上一个使用多线程的方法

![Img](https://joker-1317382260.cos.ap-guangzhou.myqcloud.com/202304092124888.webp)





















